<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Three_D_simul_practice</title>
<meta name="generator" content="MATLAB 23.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-11-23">
<meta name="DC.source" content="Three_D_simul_practice.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">1. 환경 초기화</a>
</li>
<li>
<a href="#2">2. 사용자 정의 파라미터 설정</a>
</li>
<li>
<a href="#3">3. Figure 창 생성 및 그래프 설정</a>
</li>
<li>
<a href="#4">4. 파우더의 초기 꼭짓점 좌표 정의</a>
</li>
<li>
<a href="#5">5. 파우더의 면 정의</a>
</li>
<li>
<a href="#6">6. 파우더 패치 객체 생성</a>
</li>
<li>
<a href="#7">7. 형틀의 초기 꼭짓점 좌표 정의 (고정된 단면)</a>
</li>
<li>
<a href="#8">8. 형틀의 면 정의</a>
</li>
<li>
<a href="#9">9. 형틀 패치 객체 생성</a>
</li>
<li>
<a href="#10">10. 사다리꼴 형틀의 왼쪽 및 오른쪽 형틀 정의</a>
</li>
<li>
<a href="#11">11. 조명, 범례 추가</a>
</li>
<li>
<a href="#12">12. 애니메이션 루프</a>
</li>
</ul>
</div>
<h2 id="1">1. 환경 초기화</h2>
<pre class="codeinput">clear;
clc;
close <span class="string">all</span>;
</pre>
<h2 id="2">2. 사용자 정의 파라미터 설정</h2>
<p>옆면 각도 설정 (도 단위)</p>
<pre class="codeinput">side_angle_deg = 60;                <span class="comment">% 파우더 옆면의 각도 (도)</span>
side_angle_rad = deg2rad(side_angle_deg); <span class="comment">% 각도 라디안으로 변환</span>
<span class="comment">% 파우더 파라미터</span>
length_gold = 20;                   <span class="comment">% 파우더의 길이 (X축 방향, 단위: cm)</span>
lower_base_initial_gold = 2;        <span class="comment">% 파우더의 사다리꼴 아랫변 초기 길이 (Y축 방향, 단위: cm)</span>
height_initial_gold = 1;            <span class="comment">% 파우더의 사다리꼴 높이 초기 값 (Z축 방향, 단위: cm)</span>
upper_base_initial_gold = lower_base_initial_gold - 2 * height_initial_gold / tan(side_angle_rad);        <span class="comment">% 파우더의 사다리꼴 윗변 초기 길이 (Y축 방향, 단위: cm)</span>
<span class="comment">% 단면 확장 파라미터</span>
num_expand_steps = 10;               <span class="comment">% 단면 확장 단계 수</span>
num_expand_frames = 30;              <span class="comment">% 단면 확장 당 프레임 수</span>
t = 0.1;                             <span class="comment">% 각 확장 단계마다 높이 증가량 (cm)</span>
delta_base = t / sin(side_angle_rad); <span class="comment">% 각도에 따른 아랫변과 윗변 증가량 (cm)</span>
<span class="comment">% 형틀 파라미터 (고정된 단면)</span>
length_bar = 2;                      <span class="comment">% 형틀의 길이 (X축 방향, 단위: cm)</span>
lower_base_bar = upper_base_initial_gold + delta_base; <span class="comment">% 형틀의 사다리꼴 아랫변 길이 (Y축 방향, 단위: cm)</span>
height_bar = 0.5;                    <span class="comment">% 형틀의 사다리꼴 높이 (Z축 방향, 단위: cm)</span>
upper_base_bar = lower_base_bar - 2 * height_bar / tan(side_angle_rad); <span class="comment">% 형틀의 사다리꼴 윗변 길이 (Y축 방향, 단위: cm)</span>
<span class="comment">% 애니메이션 설정</span>
num_traverse_frames = 60;            <span class="comment">% 형틀 왕복 이동 프레임 수 (30 forward, 30 backward)</span>
half_traverse = num_traverse_frames / 2; <span class="comment">% 한 방향으로 이동하는 프레임 수</span>
<span class="comment">% 형틀 이동 거리</span>
total_move_distance = length_gold - length_bar; <span class="comment">% 형틀가 이동할 수 있는 총 거리 (cm)</span>
</pre>
<h2 id="3">3. Figure 창 생성 및 그래프 설정</h2>
<pre class="codeinput">figure;
hold <span class="string">on</span>;
grid <span class="string">on</span>;
axis <span class="string">equal</span>;
xlabel(<span class="string">'X축 (cm)'</span>);
ylabel(<span class="string">'Y축 (cm)'</span>);
zlabel(<span class="string">'Z축 (cm)'</span>);
title(<span class="string">'형틀이 움직인 후 파우더가 쌓이는 애니메이션'</span>);
view(30, 30); <span class="comment">% 초기 보기 각도 설정</span>
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_01.png" alt=""> <h2 id="4">4. 파우더의 초기 꼭짓점 좌표 정의</h2>
<pre class="codeinput">vertices_gold = [
    0,        -lower_base_initial_gold/2, 0;                        <span class="comment">% V1: 앞쪽 아랫변 좌측</span>
    0,         lower_base_initial_gold/2, 0;                        <span class="comment">% V2: 앞쪽 아랫변 우측</span>
    0,         upper_base_initial_gold/2, height_initial_gold;       <span class="comment">% V3: 앞쪽 윗변 우측</span>
    0,        -upper_base_initial_gold/2, height_initial_gold;       <span class="comment">% V4: 앞쪽 윗변 좌측</span>
    length_gold, -lower_base_initial_gold/2, 0;                        <span class="comment">% V5: 뒤쪽 아랫변 좌측</span>
    length_gold,  lower_base_initial_gold/2, 0;                        <span class="comment">% V6: 뒤쪽 아랫변 우측</span>
    length_gold,  upper_base_initial_gold/2, height_initial_gold;       <span class="comment">% V7: 뒤쪽 윗변 우측</span>
    length_gold, -upper_base_initial_gold/2, height_initial_gold        <span class="comment">% V8: 뒤쪽 윗변 좌측</span>
];
</pre>
<h2 id="5">5. 파우더의 면 정의</h2>
<pre class="codeinput">faces_gold = [
    1 2 3 4;  <span class="comment">% 앞쪽 면 (이등변 사다리꼴)</span>
    5 6 7 8;  <span class="comment">% 뒤쪽 면 (이등변 사다리꼴)</span>
    1 2 6 5;  <span class="comment">% 하단 면 (직사각형)</span>
    2 3 7 6;  <span class="comment">% 우측 측면 (사다리꼴과 직사각형의 조합)</span>
    3 4 8 7;  <span class="comment">% 상단 면 (직사각형)</span>
    4 1 5 8   <span class="comment">% 좌측 측면 (사다리꼴과 직사각형의 조합)</span>
];
</pre>
<h2 id="6">6. 파우더 패치 객체 생성</h2>
<pre class="codeinput">patch_handle_gold = patch(<span class="string">'Vertices'</span>, vertices_gold, <span class="string">'Faces'</span>, faces_gold, <span class="keyword">...</span>
    <span class="string">'FaceColor'</span>, [128 128 128]/255, <span class="keyword">...</span><span class="comment"> % 회색 RGB 값</span>
    <span class="string">'EdgeColor'</span>, <span class="string">'k'</span>, <span class="keyword">...</span><span class="comment">                       % 검은색 가장자리</span>
    <span class="string">'FaceLighting'</span>, <span class="string">'gouraud'</span>, <span class="keyword">...</span><span class="comment">               % Gouraud 조명 모델 적용</span>
    <span class="string">'AmbientStrength'</span>, 0.3, <span class="keyword">...</span>
    <span class="string">'FaceAlpha'</span>, 0.3);                            <span class="comment">% 투명도 설정 (0: 완전 투명, 1: 불투명)</span>
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_02.png" alt=""> <h2 id="7">7. 형틀의 초기 꼭짓점 좌표 정의 (고정된 단면)</h2>
<pre class="codeinput">current_gold_height = height_initial_gold; <span class="comment">% 현재 파우더 높이</span>
vertices_bar_initial = [
    0,        -lower_base_bar/2, current_gold_height + t;    <span class="comment">% V1: 형틀 앞쪽 아랫변 좌측</span>
    0,         lower_base_bar/2, current_gold_height + t;    <span class="comment">% V2: 형틀 앞쪽 아랫변 우측</span>
    0,         upper_base_bar/2, current_gold_height + t + height_bar;  <span class="comment">% V3: 형틀 앞쪽 윗변 우측</span>
    0,        -upper_base_bar/2, current_gold_height + t + height_bar;  <span class="comment">% V4: 형틀 앞쪽 윗변 좌측</span>
    length_bar, -lower_base_bar/2, current_gold_height + t;    <span class="comment">% V5: 형틀 뒤쪽 아랫변 좌측 (고정 Z &gt; 파우더 윗면)</span>
    length_bar,  lower_base_bar/2, current_gold_height + t;    <span class="comment">% V6: 형틀 뒤쪽 아랫변 우측 (고정 Z &gt; 파우더 윗면)</span>
    length_bar,  upper_base_bar/2, current_gold_height + t + height_bar;  <span class="comment">% V7: 형틀 뒤쪽 윗변 우측</span>
    length_bar, -upper_base_bar/2, current_gold_height + t + height_bar   <span class="comment">% V8: 형틀 뒤쪽 윗변 좌측</span>
];
</pre>
<h2 id="8">8. 형틀의 면 정의</h2>
<pre class="codeinput">faces_bar = [
    1 2 3 4;  <span class="comment">% 앞쪽 면 (사다리꼴)</span>
    5 6 7 8;  <span class="comment">% 뒤쪽 면 (사다리꼴)</span>
    1 2 6 5;  <span class="comment">% 하단 면 (직사각형)</span>
    2 3 7 6;  <span class="comment">% 우측 측면 (사다리꼴과 직사각형의 조합)</span>
    3 4 8 7;  <span class="comment">% 상단 면 (직사각형)</span>
    4 1 5 8   <span class="comment">% 좌측 측면 (사다리꼴과 직사각형의 조합)</span>
];
</pre>
<h2 id="9">9. 형틀 패치 객체 생성</h2>
<pre class="codeinput">patch_handle_bar = patch(<span class="string">'Vertices'</span>, vertices_bar_initial, <span class="string">'Faces'</span>, faces_bar, <span class="keyword">...</span>
    <span class="string">'FaceColor'</span>, [0 1 0], <span class="keyword">...</span><span class="comment"> % 회색 RGB 값</span>
    <span class="string">'EdgeColor'</span>, <span class="string">'k'</span>, <span class="keyword">...</span><span class="comment">              % 검은색 가장자리</span>
    <span class="string">'FaceLighting'</span>, <span class="string">'gouraud'</span>, <span class="keyword">...</span><span class="comment">      % Gouraud 조명 모델 적용</span>
    <span class="string">'AmbientStrength'</span>, 0.3, <span class="keyword">...</span>
    <span class="string">'FaceAlpha'</span>, 1);                    <span class="comment">% 형틀 투명도 설정 (불투명)</span>
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_03.png" alt=""> <h2 id="10">10. 사다리꼴 형틀의 왼쪽 및 오른쪽 형틀 정의</h2>
<pre class="codeinput">init_branch_upper = upper_base_bar/2+(current_gold_height + t + height_bar)/tan(side_angle_rad);
<span class="comment">% 왼쪽 형틀</span>
vertices_branch_left = [
    0,        -init_branch_upper, 0; <span class="comment">% V1: 앞쪽 아랫변 좌측 (고정 Z=0)</span>
    0,        -init_branch_upper - 1, 0; <span class="comment">% V2: 앞쪽 아랫변 좌측 확장 (고정 Z=0)</span>
    0,        -upper_base_bar/2 - 1, current_gold_height + t + height_bar;               <span class="comment">% V3: 앞쪽 윗변 좌측 확장</span>
    0,        -upper_base_bar/2, current_gold_height + t + height_bar;                   <span class="comment">% V4: 앞쪽 윗변 좌측</span>
    length_bar, -init_branch_upper, 0; <span class="comment">% V5: 뒤쪽 아랫변 좌측 (고정 Z=0)</span>
    length_bar, -init_branch_upper - 1, 0; <span class="comment">% V6: 뒤쪽 아랫변 좌측 확장 (고정 Z=0)</span>
    length_bar, -upper_base_bar/2 - 1, current_gold_height + t + height_bar;               <span class="comment">% V7: 뒤쪽 윗변 좌측 확장</span>
    length_bar, -upper_base_bar/2, current_gold_height + t + height_bar                    <span class="comment">% V8: 뒤쪽 윗변 좌측</span>
];
faces_branch_left = [
    1 2 3 4;  <span class="comment">% 앞쪽 면 (사다리꼴)</span>
    5 6 7 8;  <span class="comment">% 뒤쪽 면 (사다리꼴)</span>
    1 2 6 5;  <span class="comment">% 하단 면 (직사각형)</span>
    2 3 7 6;  <span class="comment">% 우측 측면 (사다리꼴과 직사각형의 조합)</span>
    3 4 8 7;  <span class="comment">% 상단 면 (직사각형)</span>
    4 1 5 8   <span class="comment">% 좌측 측면 (사다리꼴과 직사각형의 조합)</span>
];
patch_handle_branch_left = patch(<span class="string">'Vertices'</span>, vertices_branch_left, <span class="string">'Faces'</span>, faces_branch_left, <span class="keyword">...</span>
    <span class="string">'FaceColor'</span>, [0 1 0], <span class="keyword">...</span><span class="comment"> % 회색 RGB 값</span>
    <span class="string">'EdgeColor'</span>, <span class="string">'k'</span>, <span class="keyword">...</span><span class="comment">              % 검은색 가장자리</span>
    <span class="string">'FaceLighting'</span>, <span class="string">'gouraud'</span>, <span class="keyword">...</span><span class="comment">      % Gouraud 조명 모델 적용</span>
    <span class="string">'AmbientStrength'</span>, 0.3, <span class="keyword">...</span>
    <span class="string">'FaceAlpha'</span>, 1);                    <span class="comment">% 형틀 투명도 설정 (불투명)</span>
<span class="comment">% 오른쪽 형틀</span>
vertices_branch_right = [
    0,         init_branch_upper, 0; <span class="comment">% V1: 앞쪽 아랫변 우측 (고정 Z=0)</span>
    0,         init_branch_upper + 1, 0;  <span class="comment">% V2: 앞쪽 아랫변 우측 확장 (고정 Z=0)</span>
    0,         upper_base_bar/2 + 1, current_gold_height + t + height_bar;               <span class="comment">% V3: 앞쪽 윗변 우측 확장</span>
    0,         upper_base_bar/2, current_gold_height + t + height_bar;                   <span class="comment">% V4: 앞쪽 윗변 우측</span>
    length_bar,  init_branch_upper, 0;  <span class="comment">% V5: 뒤쪽 아랫변 우측 (고정 Z=0)</span>
    length_bar,  init_branch_upper + 1, 0; <span class="comment">% V6: 뒤쪽 아랫변 우측 확장 (고정 Z=0)</span>
    length_bar,  upper_base_bar/2 + 1, current_gold_height + t + height_bar;               <span class="comment">% V7: 뒤쪽 윗변 우측 확장</span>
    length_bar,  upper_base_bar/2, current_gold_height + t + height_bar                    <span class="comment">% V8: 뒤쪽 윗변 우측</span>
];
faces_branch_right = [
    1 2 3 4;  <span class="comment">% 앞쪽 면 (사다리꼴)</span>
    5 6 7 8;  <span class="comment">% 뒤쪽 면 (사다리꼴)</span>
    1 2 6 5;  <span class="comment">% 하단 면 (직사각형)</span>
    2 3 7 6;  <span class="comment">% 우측 측면 (사다리꼴과 직사각형의 조합)</span>
    3 4 8 7;  <span class="comment">% 상단 면 (직사각형)</span>
    4 1 5 8   <span class="comment">% 좌측 측면 (사다리꼴과 직사각형의 조합)</span>
];
patch_handle_branch_right = patch(<span class="string">'Vertices'</span>, vertices_branch_right, <span class="string">'Faces'</span>, faces_branch_right, <span class="keyword">...</span>
    <span class="string">'FaceColor'</span>, [0 1 0], <span class="keyword">...</span><span class="comment"> % 회색 RGB 값</span>
    <span class="string">'EdgeColor'</span>, <span class="string">'k'</span>, <span class="keyword">...</span><span class="comment">              % 검은색 가장자리</span>
    <span class="string">'FaceLighting'</span>, <span class="string">'gouraud'</span>, <span class="keyword">...</span><span class="comment">      % Gouraud 조명 모델 적용</span>
    <span class="string">'AmbientStrength'</span>, 0.3, <span class="keyword">...</span>
    <span class="string">'FaceAlpha'</span>, 1);                    <span class="comment">% 형틀 투명도 설정 (불투명)</span>
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_04.png" alt=""> <h2 id="11">11. 조명, 범례 추가</h2>
<pre class="codeinput">camlight(<span class="string">'headlight'</span>);    <span class="comment">% 카메라 위치에서 조명 추가</span>
lighting <span class="string">gouraud</span>;         <span class="comment">% Gouraud 조명 모델 적용</span>
material <span class="string">shiny</span>;           <span class="comment">% 금속 반사 특성 설정</span>

legend(<span class="string">"파우더"</span>, <span class="string">"형틀"</span>)
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_05.png" alt=""> <h2 id="12">12. 애니메이션 루프</h2>
<p>현재 형틀와 형틀의 상태를 저장할 변수 초기화</p>
<pre class="codeinput">current_vertices_bar = vertices_bar_initial;              <span class="comment">% 형틀의 현재 꼭짓점</span>
current_vertices_branch_left = vertices_branch_left;      <span class="comment">% 왼쪽 형틀의 현재 꼭짓점</span>
current_vertices_branch_right = vertices_branch_right;    <span class="comment">% 오른쪽 형틀의 현재 꼭짓점</span>
current_lower_base_bar = lower_base_bar;
current_upper_base_bar = upper_base_bar;
current_height_gold = current_gold_height;
<span class="keyword">for</span> step = 1:num_expand_steps
    <span class="comment">% Phase 1: 형틀 왕복 이동</span>
    <span class="keyword">for</span> frame = 1:num_traverse_frames
        <span class="keyword">if</span> frame &lt;= half_traverse
            <span class="comment">% 전진</span>
            move_fraction = frame / half_traverse;
        <span class="keyword">else</span>
            <span class="comment">% 후진</span>
            move_fraction = (num_traverse_frames - frame) / half_traverse;
        <span class="keyword">end</span>
        current_move = move_fraction * total_move_distance;

        <span class="comment">% 형틀의 X 좌표 업데이트</span>
        new_vertices_bar = current_vertices_bar;
        new_vertices_bar(:,1) = new_vertices_bar(:,1) + current_move;

        <span class="comment">% 형틀 패치 업데이트</span>
        set(patch_handle_bar, <span class="string">'Vertices'</span>, new_vertices_bar);

        <span class="comment">% 왼쪽 형틀의 X 좌표 업데이트</span>
        new_vertices_branch_left = current_vertices_branch_left;
        new_vertices_branch_left(:,1) = new_vertices_branch_left(:,1) + current_move;
        set(patch_handle_branch_left, <span class="string">'Vertices'</span>, new_vertices_branch_left);

        <span class="comment">% 오른쪽 형틀의 X 좌표 업데이트</span>
        new_vertices_branch_right = current_vertices_branch_right;
        new_vertices_branch_right(:,1) = new_vertices_branch_right(:,1) + current_move;
        set(patch_handle_branch_right, <span class="string">'Vertices'</span>, new_vertices_branch_right);

        <span class="comment">% 화면 업데이트</span>
        drawnow;

        <span class="comment">% 애니메이션 속도 조절</span>
        pause(0.02);
    <span class="keyword">end</span>

    <span class="comment">% Phase 2: 파우더 단면 확장 (animated over num_expand_frames)</span>
    <span class="keyword">for</span> expand_frame = 1:num_expand_frames
        <span class="comment">% 파우더 치수 업데이트 (cumulative)</span>
        side_diff = (step-1)*delta_base + (delta_base * expand_frame / num_expand_frames);
        up_diff = (step-1)*t + (t * expand_frame / num_expand_frames);
        new_lower_base_gold = lower_base_initial_gold + side_diff;
        new_upper_base_gold = upper_base_initial_gold + (step-1)*delta_base + (delta_base * expand_frame / num_expand_frames);
        new_height_gold = height_initial_gold + up_diff;

        <span class="comment">% 파우더 꼭짓점 재계산</span>
        new_vertices_gold = [
            0,        -new_lower_base_gold/2, 0;                        <span class="comment">% V1: 앞쪽 아랫변 좌측</span>
            0,         new_lower_base_gold/2, 0;                        <span class="comment">% V2: 앞쪽 아랫변 우측</span>
            0,         new_upper_base_gold/2, new_height_gold;           <span class="comment">% V3: 앞쪽 윗변 우측</span>
            0,        -new_upper_base_gold/2, new_height_gold;           <span class="comment">% V4: 앞쪽 윗변 좌측</span>
            length_gold, -new_lower_base_gold/2, 0;                        <span class="comment">% V5: 뒤쪽 아랫변 좌측</span>
            length_gold,  new_lower_base_gold/2, 0;                        <span class="comment">% V6: 뒤쪽 아랫변 우측</span>
            length_gold,  new_upper_base_gold/2, new_height_gold;           <span class="comment">% V7: 뒤쪽 윗변 우측</span>
            length_gold, -new_upper_base_gold/2, new_height_gold            <span class="comment">% V8: 뒤쪽 윗변 좌측</span>
        ];

        <span class="comment">% 파우더 패치 업데이트</span>
        set(patch_handle_gold, <span class="string">'Vertices'</span>, new_vertices_gold);

        <span class="comment">% 형틀의 Z, Y 좌표 업데이트하여 사다리꼴 모양 유지</span>
        new_vertices_bar = get(patch_handle_bar, <span class="string">'Vertices'</span>);
        new_vertices_bar(1:2,3) = new_height_gold + t;           <span class="comment">% 앞쪽 아랫변</span>
        new_vertices_bar(3:4,3) = new_height_gold + t + height_bar;       <span class="comment">% 앞쪽 윗변</span>
        new_vertices_bar(5:6,3) = new_height_gold + t;           <span class="comment">% 뒤쪽 아랫변 (z &gt; 파우더 윗면)</span>
        new_vertices_bar(7:8,3) = new_height_gold + t + height_bar;       <span class="comment">% 뒤쪽 윗변</span>

        new_vertices_bar(1,2) = -lower_base_bar/2 - side_diff/2;
        new_vertices_bar(2, 2) = lower_base_bar/2 + side_diff/2;
        new_vertices_bar(3, 2) = upper_base_bar/2 + side_diff/2;
        new_vertices_bar(4, 2) = -upper_base_bar/2 - side_diff/2;
        new_vertices_bar(5, 2) = -lower_base_bar/2 - side_diff/2;
        new_vertices_bar(6, 2) = lower_base_bar/2 + side_diff/2;
        new_vertices_bar(7, 2) = upper_base_bar/2 + side_diff/2;
        new_vertices_bar(8, 2) = -upper_base_bar/2 - side_diff/2;

        set(patch_handle_bar, <span class="string">'Vertices'</span>, new_vertices_bar);

        <span class="comment">% 형틀의 현재 상태 업데이트</span>
        current_vertices_bar = new_vertices_bar;

        <span class="comment">% 왼쪽 형틀의 Z, Y 좌표 업데이트</span>
        new_vertices_branch_left = get(patch_handle_branch_left, <span class="string">'Vertices'</span>);
        new_vertices_branch_left(1:2,3) = 0;                           <span class="comment">% 앞쪽 아랫변 고정 Z=0</span>
        new_vertices_branch_left(3:4,3) = new_height_gold + t + height_bar;                  <span class="comment">% 앞쪽 윗변</span>
        new_vertices_branch_left(5:6,3) = 0;                           <span class="comment">% 뒤쪽 아랫변 고정 Z=0</span>
        new_vertices_branch_left(7:8,3) = new_height_gold + t + height_bar;                  <span class="comment">% 뒤쪽 윗변</span>

        new_vertices_branch_left(1, 2) = -init_branch_upper - side_diff/2;
        new_vertices_branch_left(2, 2) = -init_branch_upper -1 - side_diff/2;
        new_vertices_branch_left(3, 2) = -upper_base_bar/2 - 1 - side_diff/2;
        new_vertices_branch_left(4, 2) = -upper_base_bar/2 - side_diff/2;
        new_vertices_branch_left(5, 2) = new_vertices_branch_left(1, 2);
        new_vertices_branch_left(6, 2) = new_vertices_branch_left(2, 2);
        new_vertices_branch_left(7, 2) = new_vertices_branch_left(3, 2);
        new_vertices_branch_left(8, 2) = new_vertices_branch_left(4, 2);

        set(patch_handle_branch_left, <span class="string">'Vertices'</span>, new_vertices_branch_left);

        <span class="comment">% 왼쪽 형틀의 현재 상태 업데이트</span>
        current_vertices_branch_left = new_vertices_branch_left;

        <span class="comment">% 오른쪽 형틀의 Z, Y 좌표 업데이트</span>
        new_vertices_branch_right = get(patch_handle_branch_right, <span class="string">'Vertices'</span>);
        new_vertices_branch_right(1:2,3) = 0;                          <span class="comment">% 앞쪽 아랫변 고정 Z=0</span>
        new_vertices_branch_right(3:4,3) = new_height_gold + t + height_bar;                 <span class="comment">% 앞쪽 윗변</span>
        new_vertices_branch_right(5:6,3) = 0;                 <span class="comment">% 뒤쪽 아랫변 고정 Z &gt; 파우더 윗면</span>
        new_vertices_branch_right(7:8,3) = new_height_gold + t + height_bar;                 <span class="comment">% 뒤쪽 윗변</span>

        <span class="comment">% 오른쪽 형틀</span>
        vertices_branch_right = [
            0,         init_branch_upper, 0; <span class="comment">% V1: 앞쪽 아랫변 우측 (고정 Z=0)</span>
            0,         init_branch_upper + 1, 0;  <span class="comment">% V2: 앞쪽 아랫변 우측 확장 (고정 Z=0)</span>
            0,         upper_base_bar/2 + 1, current_gold_height + t + height_bar;               <span class="comment">% V3: 앞쪽 윗변 우측 확장</span>
            0,         upper_base_bar/2, current_gold_height + t + height_bar;                   <span class="comment">% V4: 앞쪽 윗변 우측</span>
            length_bar,  init_branch_upper, 0;  <span class="comment">% V5: 뒤쪽 아랫변 우측 (고정 Z=0)</span>
            length_bar,  init_branch_upper + 1, 0; <span class="comment">% V6: 뒤쪽 아랫변 우측 확장 (고정 Z=0)</span>
            length_bar,  upper_base_bar/2 + 1, current_gold_height + t + height_bar;               <span class="comment">% V7: 뒤쪽 윗변 우측 확장</span>
            length_bar,  upper_base_bar/2, current_gold_height + t + height_bar                    <span class="comment">% V8: 뒤쪽 윗변 우측</span>
        ];

        new_vertices_branch_right(1, 2) = - new_vertices_branch_left(1, 2);
        new_vertices_branch_right(2, 2) = - new_vertices_branch_left(2, 2);
        new_vertices_branch_right(3, 2) = - new_vertices_branch_left(3, 2);
        new_vertices_branch_right(4, 2) = - new_vertices_branch_left(4, 2);
        new_vertices_branch_right(5, 2) = - new_vertices_branch_left(5, 2);
        new_vertices_branch_right(6, 2) = - new_vertices_branch_left(6, 2);
        new_vertices_branch_right(7, 2) = - new_vertices_branch_left(7, 2);
        new_vertices_branch_right(8, 2) = - new_vertices_branch_left(8, 2);

        set(patch_handle_branch_right, <span class="string">'Vertices'</span>, new_vertices_branch_right);

        <span class="comment">% 오른쪽 형틀의 현재 상태 업데이트</span>
        current_vertices_branch_right = new_vertices_branch_right;

        <span class="comment">% 화면 업데이트</span>
        drawnow;

        <span class="comment">% 애니메이션 속도 조절</span>
        pause(0.0001);
    <span class="keyword">end</span>


    <span class="comment">% 사다리꼴 형틀의 새 꼭짓점 재정의</span>
    new_vertices_bar(1,2) = new_vertices_bar(1,2) - delta_base; <span class="comment">% 형틀 앞쪽 아랫변 좌측</span>
    new_vertices_bar(2:3,2) = new_vertices_bar(2,2) + delta_base; <span class="comment">% 형틀 앞쪽 아랫변 우측</span>
    new_vertices_bar(4:5,2) = new_vertices_bar(1,2) - delta_base;
    new_vertices_bar(6:7,2) = new_vertices_bar(2,2) + delta_base;
    new_vertices_bar(8,2) = new_vertices_bar(1,2) - delta_base;

    set(patch_handle_bar, <span class="string">'Vertices'</span>, vertices_bar_initial);

    <span class="comment">% 사다리꼴 형틀의 꼭짓점 업데이트 후 형틀의 꼭짓점도 업데이트</span>
    new_vertices_branch_left(:,2) = new_vertices_branch_left(:,2) - delta_base; <span class="comment">% 형틀 앞쪽 아랫변 좌측</span>
    set(patch_handle_branch_left, <span class="string">'Vertices'</span>, vertices_branch_left);

    new_vertices_branch_right(:,2) = new_vertices_branch_right(:,2) + delta_base;
    set(patch_handle_branch_right, <span class="string">'Vertices'</span>, vertices_branch_right);
<span class="keyword">end</span>
hold <span class="string">off</span>;
</pre>
<img vspace="5" hspace="5" src="Three_D_simul_practice_06.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% 1. 환경 초기화
clear;
clc;
close all;
%% 2. 사용자 정의 파라미터 설정
% 옆면 각도 설정 (도 단위)
side_angle_deg = 60;                % 파우더 옆면의 각도 (도)
side_angle_rad = deg2rad(side_angle_deg); % 각도 라디안으로 변환
% 파우더 파라미터
length_gold = 20;                   % 파우더의 길이 (X축 방향, 단위: cm)
lower_base_initial_gold = 2;        % 파우더의 사다리꼴 아랫변 초기 길이 (Y축 방향, 단위: cm)
height_initial_gold = 1;            % 파우더의 사다리꼴 높이 초기 값 (Z축 방향, 단위: cm)
upper_base_initial_gold = lower_base_initial_gold - 2 * height_initial_gold / tan(side_angle_rad);        % 파우더의 사다리꼴 윗변 초기 길이 (Y축 방향, 단위: cm)
% 단면 확장 파라미터
num_expand_steps = 10;               % 단면 확장 단계 수
num_expand_frames = 30;              % 단면 확장 당 프레임 수
t = 0.1;                             % 각 확장 단계마다 높이 증가량 (cm)
delta_base = t / sin(side_angle_rad); % 각도에 따른 아랫변과 윗변 증가량 (cm)
% 형틀 파라미터 (고정된 단면)
length_bar = 2;                      % 형틀의 길이 (X축 방향, 단위: cm)
lower_base_bar = upper_base_initial_gold + delta_base; % 형틀의 사다리꼴 아랫변 길이 (Y축 방향, 단위: cm)
height_bar = 0.5;                    % 형틀의 사다리꼴 높이 (Z축 방향, 단위: cm)
upper_base_bar = lower_base_bar - 2 * height_bar / tan(side_angle_rad); % 형틀의 사다리꼴 윗변 길이 (Y축 방향, 단위: cm)
% 애니메이션 설정
num_traverse_frames = 60;            % 형틀 왕복 이동 프레임 수 (30 forward, 30 backward)
half_traverse = num_traverse_frames / 2; % 한 방향으로 이동하는 프레임 수
% 형틀 이동 거리
total_move_distance = length_gold - length_bar; % 형틀가 이동할 수 있는 총 거리 (cm)
%% 3. Figure 창 생성 및 그래프 설정
figure;
hold on;
grid on;
axis equal;
xlabel('X축 (cm)');
ylabel('Y축 (cm)');
zlabel('Z축 (cm)');
title('형틀이 움직인 후 파우더가 쌓이는 애니메이션');
view(30, 30); % 초기 보기 각도 설정
%% 4. 파우더의 초기 꼭짓점 좌표 정의
vertices_gold = [
    0,        -lower_base_initial_gold/2, 0;                        % V1: 앞쪽 아랫변 좌측
    0,         lower_base_initial_gold/2, 0;                        % V2: 앞쪽 아랫변 우측
    0,         upper_base_initial_gold/2, height_initial_gold;       % V3: 앞쪽 윗변 우측
    0,        -upper_base_initial_gold/2, height_initial_gold;       % V4: 앞쪽 윗변 좌측
    length_gold, -lower_base_initial_gold/2, 0;                        % V5: 뒤쪽 아랫변 좌측
    length_gold,  lower_base_initial_gold/2, 0;                        % V6: 뒤쪽 아랫변 우측
    length_gold,  upper_base_initial_gold/2, height_initial_gold;       % V7: 뒤쪽 윗변 우측
    length_gold, -upper_base_initial_gold/2, height_initial_gold        % V8: 뒤쪽 윗변 좌측
];
%% 5. 파우더의 면 정의
faces_gold = [
    1 2 3 4;  % 앞쪽 면 (이등변 사다리꼴)
    5 6 7 8;  % 뒤쪽 면 (이등변 사다리꼴)
    1 2 6 5;  % 하단 면 (직사각형)
    2 3 7 6;  % 우측 측면 (사다리꼴과 직사각형의 조합)
    3 4 8 7;  % 상단 면 (직사각형)
    4 1 5 8   % 좌측 측면 (사다리꼴과 직사각형의 조합)
];
%% 6. 파우더 패치 객체 생성
patch_handle_gold = patch('Vertices', vertices_gold, 'Faces', faces_gold, ...
    'FaceColor', [128 128 128]/255, ... % 회색 RGB 값
    'EdgeColor', 'k', ...                       % 검은색 가장자리
    'FaceLighting', 'gouraud', ...               % Gouraud 조명 모델 적용
    'AmbientStrength', 0.3, ...
    'FaceAlpha', 0.3);                            % 투명도 설정 (0: 완전 투명, 1: 불투명)
%% 7. 형틀의 초기 꼭짓점 좌표 정의 (고정된 단면)
current_gold_height = height_initial_gold; % 현재 파우더 높이
vertices_bar_initial = [
    0,        -lower_base_bar/2, current_gold_height + t;    % V1: 형틀 앞쪽 아랫변 좌측
    0,         lower_base_bar/2, current_gold_height + t;    % V2: 형틀 앞쪽 아랫변 우측
    0,         upper_base_bar/2, current_gold_height + t + height_bar;  % V3: 형틀 앞쪽 윗변 우측
    0,        -upper_base_bar/2, current_gold_height + t + height_bar;  % V4: 형틀 앞쪽 윗변 좌측
    length_bar, -lower_base_bar/2, current_gold_height + t;    % V5: 형틀 뒤쪽 아랫변 좌측 (고정 Z > 파우더 윗면)
    length_bar,  lower_base_bar/2, current_gold_height + t;    % V6: 형틀 뒤쪽 아랫변 우측 (고정 Z > 파우더 윗면)
    length_bar,  upper_base_bar/2, current_gold_height + t + height_bar;  % V7: 형틀 뒤쪽 윗변 우측
    length_bar, -upper_base_bar/2, current_gold_height + t + height_bar   % V8: 형틀 뒤쪽 윗변 좌측
];
%% 8. 형틀의 면 정의
faces_bar = [
    1 2 3 4;  % 앞쪽 면 (사다리꼴)
    5 6 7 8;  % 뒤쪽 면 (사다리꼴)
    1 2 6 5;  % 하단 면 (직사각형)
    2 3 7 6;  % 우측 측면 (사다리꼴과 직사각형의 조합)
    3 4 8 7;  % 상단 면 (직사각형)
    4 1 5 8   % 좌측 측면 (사다리꼴과 직사각형의 조합)
];
%% 9. 형틀 패치 객체 생성
patch_handle_bar = patch('Vertices', vertices_bar_initial, 'Faces', faces_bar, ...
    'FaceColor', [0 1 0], ... % 회색 RGB 값
    'EdgeColor', 'k', ...              % 검은색 가장자리
    'FaceLighting', 'gouraud', ...      % Gouraud 조명 모델 적용
    'AmbientStrength', 0.3, ...
    'FaceAlpha', 1);                    % 형틀 투명도 설정 (불투명)
%% 10. 사다리꼴 형틀의 왼쪽 및 오른쪽 형틀 정의
init_branch_upper = upper_base_bar/2+(current_gold_height + t + height_bar)/tan(side_angle_rad);
% 왼쪽 형틀
vertices_branch_left = [
    0,        -init_branch_upper, 0; % V1: 앞쪽 아랫변 좌측 (고정 Z=0)
    0,        -init_branch_upper - 1, 0; % V2: 앞쪽 아랫변 좌측 확장 (고정 Z=0)
    0,        -upper_base_bar/2 - 1, current_gold_height + t + height_bar;               % V3: 앞쪽 윗변 좌측 확장
    0,        -upper_base_bar/2, current_gold_height + t + height_bar;                   % V4: 앞쪽 윗변 좌측
    length_bar, -init_branch_upper, 0; % V5: 뒤쪽 아랫변 좌측 (고정 Z=0)
    length_bar, -init_branch_upper - 1, 0; % V6: 뒤쪽 아랫변 좌측 확장 (고정 Z=0)
    length_bar, -upper_base_bar/2 - 1, current_gold_height + t + height_bar;               % V7: 뒤쪽 윗변 좌측 확장
    length_bar, -upper_base_bar/2, current_gold_height + t + height_bar                    % V8: 뒤쪽 윗변 좌측
];
faces_branch_left = [
    1 2 3 4;  % 앞쪽 면 (사다리꼴)
    5 6 7 8;  % 뒤쪽 면 (사다리꼴)
    1 2 6 5;  % 하단 면 (직사각형)
    2 3 7 6;  % 우측 측면 (사다리꼴과 직사각형의 조합)
    3 4 8 7;  % 상단 면 (직사각형)
    4 1 5 8   % 좌측 측면 (사다리꼴과 직사각형의 조합)
];
patch_handle_branch_left = patch('Vertices', vertices_branch_left, 'Faces', faces_branch_left, ...
    'FaceColor', [0 1 0], ... % 회색 RGB 값
    'EdgeColor', 'k', ...              % 검은색 가장자리
    'FaceLighting', 'gouraud', ...      % Gouraud 조명 모델 적용
    'AmbientStrength', 0.3, ...
    'FaceAlpha', 1);                    % 형틀 투명도 설정 (불투명)
% 오른쪽 형틀
vertices_branch_right = [
    0,         init_branch_upper, 0; % V1: 앞쪽 아랫변 우측 (고정 Z=0)
    0,         init_branch_upper + 1, 0;  % V2: 앞쪽 아랫변 우측 확장 (고정 Z=0)
    0,         upper_base_bar/2 + 1, current_gold_height + t + height_bar;               % V3: 앞쪽 윗변 우측 확장
    0,         upper_base_bar/2, current_gold_height + t + height_bar;                   % V4: 앞쪽 윗변 우측
    length_bar,  init_branch_upper, 0;  % V5: 뒤쪽 아랫변 우측 (고정 Z=0)
    length_bar,  init_branch_upper + 1, 0; % V6: 뒤쪽 아랫변 우측 확장 (고정 Z=0)
    length_bar,  upper_base_bar/2 + 1, current_gold_height + t + height_bar;               % V7: 뒤쪽 윗변 우측 확장
    length_bar,  upper_base_bar/2, current_gold_height + t + height_bar                    % V8: 뒤쪽 윗변 우측
];
faces_branch_right = [
    1 2 3 4;  % 앞쪽 면 (사다리꼴)
    5 6 7 8;  % 뒤쪽 면 (사다리꼴)
    1 2 6 5;  % 하단 면 (직사각형)
    2 3 7 6;  % 우측 측면 (사다리꼴과 직사각형의 조합)
    3 4 8 7;  % 상단 면 (직사각형)
    4 1 5 8   % 좌측 측면 (사다리꼴과 직사각형의 조합)
];
patch_handle_branch_right = patch('Vertices', vertices_branch_right, 'Faces', faces_branch_right, ...
    'FaceColor', [0 1 0], ... % 회색 RGB 값
    'EdgeColor', 'k', ...              % 검은색 가장자리
    'FaceLighting', 'gouraud', ...      % Gouraud 조명 모델 적용
    'AmbientStrength', 0.3, ...
    'FaceAlpha', 1);                    % 형틀 투명도 설정 (불투명)
%% 11. 조명, 범례 추가
camlight('headlight');    % 카메라 위치에서 조명 추가
lighting gouraud;         % Gouraud 조명 모델 적용
material shiny;           % 금속 반사 특성 설정

legend("파우더", "형틀")
%% 12. 애니메이션 루프
% 현재 형틀와 형틀의 상태를 저장할 변수 초기화
current_vertices_bar = vertices_bar_initial;              % 형틀의 현재 꼭짓점
current_vertices_branch_left = vertices_branch_left;      % 왼쪽 형틀의 현재 꼭짓점
current_vertices_branch_right = vertices_branch_right;    % 오른쪽 형틀의 현재 꼭짓점
current_lower_base_bar = lower_base_bar;
current_upper_base_bar = upper_base_bar;
current_height_gold = current_gold_height;
for step = 1:num_expand_steps
    % Phase 1: 형틀 왕복 이동
    for frame = 1:num_traverse_frames
        if frame <= half_traverse
            % 전진
            move_fraction = frame / half_traverse;
        else
            % 후진
            move_fraction = (num_traverse_frames - frame) / half_traverse;
        end
        current_move = move_fraction * total_move_distance;
        
        % 형틀의 X 좌표 업데이트
        new_vertices_bar = current_vertices_bar;
        new_vertices_bar(:,1) = new_vertices_bar(:,1) + current_move;
        
        % 형틀 패치 업데이트
        set(patch_handle_bar, 'Vertices', new_vertices_bar);
        
        % 왼쪽 형틀의 X 좌표 업데이트
        new_vertices_branch_left = current_vertices_branch_left;
        new_vertices_branch_left(:,1) = new_vertices_branch_left(:,1) + current_move;
        set(patch_handle_branch_left, 'Vertices', new_vertices_branch_left);
        
        % 오른쪽 형틀의 X 좌표 업데이트
        new_vertices_branch_right = current_vertices_branch_right;
        new_vertices_branch_right(:,1) = new_vertices_branch_right(:,1) + current_move;
        set(patch_handle_branch_right, 'Vertices', new_vertices_branch_right);
        
        % 화면 업데이트
        drawnow;
        
        % 애니메이션 속도 조절
        pause(0.02);
    end
    
    % Phase 2: 파우더 단면 확장 (animated over num_expand_frames)
    for expand_frame = 1:num_expand_frames
        % 파우더 치수 업데이트 (cumulative)
        side_diff = (step-1)*delta_base + (delta_base * expand_frame / num_expand_frames);
        up_diff = (step-1)*t + (t * expand_frame / num_expand_frames);
        new_lower_base_gold = lower_base_initial_gold + side_diff;
        new_upper_base_gold = upper_base_initial_gold + (step-1)*delta_base + (delta_base * expand_frame / num_expand_frames);
        new_height_gold = height_initial_gold + up_diff;
        
        % 파우더 꼭짓점 재계산
        new_vertices_gold = [
            0,        -new_lower_base_gold/2, 0;                        % V1: 앞쪽 아랫변 좌측
            0,         new_lower_base_gold/2, 0;                        % V2: 앞쪽 아랫변 우측
            0,         new_upper_base_gold/2, new_height_gold;           % V3: 앞쪽 윗변 우측
            0,        -new_upper_base_gold/2, new_height_gold;           % V4: 앞쪽 윗변 좌측
            length_gold, -new_lower_base_gold/2, 0;                        % V5: 뒤쪽 아랫변 좌측
            length_gold,  new_lower_base_gold/2, 0;                        % V6: 뒤쪽 아랫변 우측
            length_gold,  new_upper_base_gold/2, new_height_gold;           % V7: 뒤쪽 윗변 우측
            length_gold, -new_upper_base_gold/2, new_height_gold            % V8: 뒤쪽 윗변 좌측
        ];
        
        % 파우더 패치 업데이트
        set(patch_handle_gold, 'Vertices', new_vertices_gold);

        % 형틀의 Z, Y 좌표 업데이트하여 사다리꼴 모양 유지
        new_vertices_bar = get(patch_handle_bar, 'Vertices');
        new_vertices_bar(1:2,3) = new_height_gold + t;           % 앞쪽 아랫변
        new_vertices_bar(3:4,3) = new_height_gold + t + height_bar;       % 앞쪽 윗변
        new_vertices_bar(5:6,3) = new_height_gold + t;           % 뒤쪽 아랫변 (z > 파우더 윗면)
        new_vertices_bar(7:8,3) = new_height_gold + t + height_bar;       % 뒤쪽 윗변
        
        new_vertices_bar(1,2) = -lower_base_bar/2 - side_diff/2;
        new_vertices_bar(2, 2) = lower_base_bar/2 + side_diff/2;
        new_vertices_bar(3, 2) = upper_base_bar/2 + side_diff/2;
        new_vertices_bar(4, 2) = -upper_base_bar/2 - side_diff/2;
        new_vertices_bar(5, 2) = -lower_base_bar/2 - side_diff/2;
        new_vertices_bar(6, 2) = lower_base_bar/2 + side_diff/2;
        new_vertices_bar(7, 2) = upper_base_bar/2 + side_diff/2;
        new_vertices_bar(8, 2) = -upper_base_bar/2 - side_diff/2;
        
        set(patch_handle_bar, 'Vertices', new_vertices_bar);
        
        % 형틀의 현재 상태 업데이트
        current_vertices_bar = new_vertices_bar;
        
        % 왼쪽 형틀의 Z, Y 좌표 업데이트
        new_vertices_branch_left = get(patch_handle_branch_left, 'Vertices');
        new_vertices_branch_left(1:2,3) = 0;                           % 앞쪽 아랫변 고정 Z=0
        new_vertices_branch_left(3:4,3) = new_height_gold + t + height_bar;                  % 앞쪽 윗변
        new_vertices_branch_left(5:6,3) = 0;                           % 뒤쪽 아랫변 고정 Z=0
        new_vertices_branch_left(7:8,3) = new_height_gold + t + height_bar;                  % 뒤쪽 윗변
        
        new_vertices_branch_left(1, 2) = -init_branch_upper - side_diff/2;
        new_vertices_branch_left(2, 2) = -init_branch_upper -1 - side_diff/2;
        new_vertices_branch_left(3, 2) = -upper_base_bar/2 - 1 - side_diff/2;
        new_vertices_branch_left(4, 2) = -upper_base_bar/2 - side_diff/2;
        new_vertices_branch_left(5, 2) = new_vertices_branch_left(1, 2);
        new_vertices_branch_left(6, 2) = new_vertices_branch_left(2, 2);
        new_vertices_branch_left(7, 2) = new_vertices_branch_left(3, 2);
        new_vertices_branch_left(8, 2) = new_vertices_branch_left(4, 2);

        set(patch_handle_branch_left, 'Vertices', new_vertices_branch_left);
        
        % 왼쪽 형틀의 현재 상태 업데이트
        current_vertices_branch_left = new_vertices_branch_left;
        
        % 오른쪽 형틀의 Z, Y 좌표 업데이트
        new_vertices_branch_right = get(patch_handle_branch_right, 'Vertices');
        new_vertices_branch_right(1:2,3) = 0;                          % 앞쪽 아랫변 고정 Z=0
        new_vertices_branch_right(3:4,3) = new_height_gold + t + height_bar;                 % 앞쪽 윗변
        new_vertices_branch_right(5:6,3) = 0;                 % 뒤쪽 아랫변 고정 Z > 파우더 윗면
        new_vertices_branch_right(7:8,3) = new_height_gold + t + height_bar;                 % 뒤쪽 윗변
        
        % 오른쪽 형틀
        vertices_branch_right = [
            0,         init_branch_upper, 0; % V1: 앞쪽 아랫변 우측 (고정 Z=0)
            0,         init_branch_upper + 1, 0;  % V2: 앞쪽 아랫변 우측 확장 (고정 Z=0)
            0,         upper_base_bar/2 + 1, current_gold_height + t + height_bar;               % V3: 앞쪽 윗변 우측 확장
            0,         upper_base_bar/2, current_gold_height + t + height_bar;                   % V4: 앞쪽 윗변 우측
            length_bar,  init_branch_upper, 0;  % V5: 뒤쪽 아랫변 우측 (고정 Z=0)
            length_bar,  init_branch_upper + 1, 0; % V6: 뒤쪽 아랫변 우측 확장 (고정 Z=0)
            length_bar,  upper_base_bar/2 + 1, current_gold_height + t + height_bar;               % V7: 뒤쪽 윗변 우측 확장
            length_bar,  upper_base_bar/2, current_gold_height + t + height_bar                    % V8: 뒤쪽 윗변 우측
        ];

        new_vertices_branch_right(1, 2) = - new_vertices_branch_left(1, 2);
        new_vertices_branch_right(2, 2) = - new_vertices_branch_left(2, 2);
        new_vertices_branch_right(3, 2) = - new_vertices_branch_left(3, 2);
        new_vertices_branch_right(4, 2) = - new_vertices_branch_left(4, 2);
        new_vertices_branch_right(5, 2) = - new_vertices_branch_left(5, 2);
        new_vertices_branch_right(6, 2) = - new_vertices_branch_left(6, 2);
        new_vertices_branch_right(7, 2) = - new_vertices_branch_left(7, 2);
        new_vertices_branch_right(8, 2) = - new_vertices_branch_left(8, 2);
        
        set(patch_handle_branch_right, 'Vertices', new_vertices_branch_right);
        
        % 오른쪽 형틀의 현재 상태 업데이트
        current_vertices_branch_right = new_vertices_branch_right;
        
        % 화면 업데이트
        drawnow;
        
        % 애니메이션 속도 조절
        pause(0.0001);
    end
    
    
    % 사다리꼴 형틀의 새 꼭짓점 재정의
    new_vertices_bar(1,2) = new_vertices_bar(1,2) - delta_base; % 형틀 앞쪽 아랫변 좌측
    new_vertices_bar(2:3,2) = new_vertices_bar(2,2) + delta_base; % 형틀 앞쪽 아랫변 우측
    new_vertices_bar(4:5,2) = new_vertices_bar(1,2) - delta_base;
    new_vertices_bar(6:7,2) = new_vertices_bar(2,2) + delta_base;
    new_vertices_bar(8,2) = new_vertices_bar(1,2) - delta_base;

    set(patch_handle_bar, 'Vertices', vertices_bar_initial);
    
    % 사다리꼴 형틀의 꼭짓점 업데이트 후 형틀의 꼭짓점도 업데이트
    new_vertices_branch_left(:,2) = new_vertices_branch_left(:,2) - delta_base; % 형틀 앞쪽 아랫변 좌측
    set(patch_handle_branch_left, 'Vertices', vertices_branch_left);
    
    new_vertices_branch_right(:,2) = new_vertices_branch_right(:,2) + delta_base;
    set(patch_handle_branch_right, 'Vertices', vertices_branch_right);
end
hold off;

##### SOURCE END #####
-->
</body>
</html>
